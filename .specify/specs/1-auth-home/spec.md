# Feature Specification: 會員註冊與登入系統以及記帳主頁顯示功能

**Feature Branch**: `1-auth-home`  
**Created**: 2025-11-13  
**Status**: Draft  
**Input**: User description: "會員註冊與登入系統以及記帳主頁顯示功能"

## User Scenarios & Testing

### User Story 1 - 使用者完成帳號註冊與 Email 驗證 (Priority: P1)

新使用者需要建立帳號才能使用記帳功能。使用者填寫註冊表單後，系統發送驗證碼到使用者的 Email，使用者輸入驗證碼完成帳號啟用。

**Why this priority**: 這是使用者進入系統的第一步，沒有註冊功能就無法建立任何使用者帳號。這是最核心的使用者入口功能。

**Independent Test**: 可透過完整的註冊流程測試 - 從填寫表單、接收驗證碼、輸入驗證碼到帳號建立成功，是一個完整且獨立的使用者旅程，可獨立交付價值。

**Acceptance Scenarios**:

1. **Given** 使用者在註冊頁面, **When** 輸入姓名「王小明」、Email「user@example.com」、密碼「Abc12345」、確認密碼「Abc12345」並點擊「註冊」, **Then** 系統發送 6 位數驗證碼到 user@example.com 並顯示驗證碼輸入頁面
2. **Given** 使用者收到驗證碼「123456」且驗證碼仍在 5 分鐘有效期內, **When** 在驗證頁面輸入「123456」並提交, **Then** 系統顯示「驗證成功」訊息並建立帳號，自動導向登入頁面
3. **Given** 使用者在註冊頁面, **When** 輸入密碼「abc123」(不符合規則), **Then** 系統顯示錯誤訊息「密碼必須為 8-20 碼，包含英文大小寫與數字」
4. **Given** 使用者在註冊頁面, **When** 輸入的「確認密碼」與「密碼」不一致, **Then** 系統顯示錯誤訊息「兩次輸入的密碼不一致」
5. **Given** 使用者已註冊過 Email「user@example.com」, **When** 再次使用相同 Email 註冊, **Then** 系統顯示錯誤訊息「此 Email 已被註冊」

---

### User Story 2 - 使用者重新發送驗證碼 (Priority: P2)

使用者可能因為沒收到驗證碼或驗證碼過期，需要重新發送驗證碼。系統提供重新發送功能，但限制 60 秒冷卻時間以避免濫用。

**Why this priority**: 這是註冊流程的補救機制，雖然重要但不是核心註冊流程的必要部分。使用者可以等待新的驗證碼或重新註冊。

**Independent Test**: 可在驗證碼頁面獨立測試重新發送功能 - 點擊「重新發送」按鈕，等待 60 秒冷卻，驗證收到新的驗證碼。

**Acceptance Scenarios**:

1. **Given** 使用者在驗證碼輸入頁面且距離上次發送已超過 60 秒, **When** 點擊「重新發送驗證碼」按鈕, **Then** 系統發送新的 6 位數驗證碼到使用者 Email，顯示「驗證碼已重新發送」訊息，按鈕進入 60 秒冷卻狀態
2. **Given** 使用者在驗證碼輸入頁面且距離上次發送未滿 60 秒, **When** 嘗試點擊「重新發送驗證碼」按鈕, **Then** 按鈕顯示為禁用狀態並顯示剩餘秒數「請等待 XX 秒後重新發送」
3. **Given** 使用者收到第一個驗證碼「123456」並重新發送取得新驗證碼「789012」, **When** 輸入舊驗證碼「123456」, **Then** 系統顯示錯誤訊息「驗證碼錯誤或已過期」
4. **Given** 驗證碼已發送 6 分鐘（超過 5 分鐘有效期）, **When** 使用者輸入該驗證碼, **Then** 系統顯示錯誤訊息「驗證碼已過期，請重新發送」

---

### User Story 3 - 使用者登入系統 (Priority: P1)

已註冊的使用者使用 Email 和密碼登入系統，登入成功後可以開始使用記帳功能。系統自動儲存會話，下次開啟 APP 可自動登入。

**Why this priority**: 這是使用者回訪系統的必要功能，與註冊功能同等重要。沒有登入功能，使用者註冊後無法再次進入系統。

**Independent Test**: 可使用已註冊帳號獨立測試完整登入流程 - 輸入 Email 和密碼，驗證登入成功後進入主頁，關閉 APP 重新開啟驗證自動登入。

**Acceptance Scenarios**:

1. **Given** 使用者已完成註冊且在登入頁面, **When** 輸入正確的 Email「user@example.com」和密碼「Abc12345」並點擊「登入」, **Then** 系統驗證成功，儲存會話，導向記帳主頁
2. **Given** 使用者在登入頁面, **When** 輸入正確的 Email 但錯誤的密碼, **Then** 系統顯示錯誤訊息「Email 或密碼錯誤」
3. **Given** 使用者在登入頁面, **When** 輸入未註冊的 Email, **Then** 系統顯示錯誤訊息「Email 或密碼錯誤」（不透露 Email 是否存在以保護隱私）
4. **Given** 使用者已登入且關閉 APP, **When** 重新開啟 APP, **Then** 系統自動驗證會話有效性，直接進入記帳主頁（不需重新輸入密碼）
5. **Given** 使用者在登入頁面, **When** Email 或密碼欄位為空, **Then** 系統顯示錯誤訊息「請輸入 Email 和密碼」

---

### User Story 4 - 使用者登出系統 (Priority: P2)

使用者可以主動登出系統，清除當前會話資料。這在使用共用裝置或切換帳號時很重要。

**Why this priority**: 這是安全性功能，雖然重要但不影響核心使用流程。使用者可以透過解除安裝或清除 APP 資料達到類似效果。

**Independent Test**: 可在已登入狀態下獨立測試 - 點擊登出按鈕，驗證返回登入頁面且會話已清除。

**Acceptance Scenarios**:

1. **Given** 使用者已登入並在記帳主頁, **When** 點擊「登出」按鈕並確認, **Then** 系統清除會話資料，返回登入頁面
2. **Given** 使用者已登出, **When** 重新開啟 APP, **Then** 系統顯示登入頁面（不自動登入）
3. **Given** 使用者點擊登出按鈕, **When** 系統顯示確認對話框, **Then** 對話框包含「確定要登出嗎？」訊息與「取消」、「登出」按鈕

---

### User Story 5 - 使用者查看記帳主頁 (Priority: P3)

使用者登入後看到記帳主頁，目前顯示「功能開發中」的施工圖示與提示訊息。

**Why this priority**: 這是未來功能的佔位頁面，對當前 MVP 不提供實際價值。但提供清楚的視覺回饋讓使用者知道系統正在開發中。

**Independent Test**: 可在登入後獨立驗證主頁顯示 - 確認頁面顯示施工圖示、標題「功能開發中」、說明文字「記帳功能即將上線，敬請期待！」。

**Acceptance Scenarios**:

1. **Given** 使用者成功登入, **When** 系統導向記帳主頁, **Then** 頁面顯示施工圖示、標題「功能開發中」、說明文字「記帳功能即將上線，敬請期待！」
2. **Given** 使用者在記帳主頁, **When** 檢視頁面元素, **Then** 頁面包含應用程式標題「記帳App」、選單按鈕、通知按鈕、登出按鈕
3. **Given** 使用者自動登入進入主頁, **When** 頁面載入完成, **Then** 施工中訊息清楚可見且居中顯示

---

### Edge Cases

- **驗證碼輸入錯誤多次**: 使用者連續輸入錯誤驗證碼 5 次後，系統應要求重新發送驗證碼並鎖定舊驗證碼
- **Email 格式驗證**: 系統如何處理無效的 Email 格式（例如缺少 @、無效網域）？應在前端即時驗證並顯示錯誤訊息
- **會話過期**: 使用者長時間未使用 APP（例如 30 天），自動登入會話是否應該過期？系統應要求重新登入
- **密碼欄位安全性**: 密碼輸入欄位應預設隱藏字元，提供「顯示/隱藏密碼」切換按鈕
- **網路連線問題**: 註冊或登入過程中網路中斷，系統應顯示友善錯誤訊息「網路連線失敗，請檢查網路後重試」
- **重複註冊請求**: 使用者快速連續點擊「註冊」按鈕，系統應防止重複發送驗證碼（按鈕應在處理期間顯示載入狀態並禁用）
- **特殊字元處理**: 姓名欄位應支援中文、英文及常見符號，但需過濾危險字元以防止注入攻擊
- **驗證碼顯示方式**: 驗證碼輸入欄位應提供清楚的視覺回饋（例如 6 個獨立格子或自動分隔符號）
- **Email 大小寫處理**: 系統應將 Email 統一轉換為小寫儲存和比對（例如 User@Example.com 與 user@example.com 視為相同）
- **登入狀態同步**: 使用者在多個裝置登入，其中一個裝置登出時，其他裝置的會話如何處理？目前設計為每個裝置獨立會話

## Requirements

### Functional Requirements

**註冊功能**

- **FR-001**: 系統必須提供註冊表單，包含以下欄位：姓名（必填，50 字元以內）、Email（必填）、密碼（必填）、確認密碼（必填）
- **FR-002**: 系統必須驗證密碼符合規則：長度 8-20 碼，必須包含至少一個英文大寫字母、一個英文小寫字母、一個數字
- **FR-003**: 系統必須驗證「密碼」與「確認密碼」欄位內容一致
- **FR-004**: 系統必須驗證 Email 格式有效（包含 @ 符號且符合標準 Email 格式）
- **FR-005**: 系統必須檢查 Email 是否已被註冊，若已存在則拒絕註冊並顯示錯誤訊息
- **FR-006**: 系統必須在使用者提交註冊表單後，生成 6 位數隨機數字驗證碼
- **FR-007**: 系統必須將驗證碼發送到使用者填寫的 Email 地址
- **FR-008**: 系統必須記錄驗證碼的建立時間，設定 5 分鐘有效期
- **FR-009**: 系統必須在發送驗證碼後，導向驗證碼輸入頁面

**Email 驗證功能**

- **FR-010**: 系統必須提供驗證碼輸入介面，顯示使用者註冊的 Email 地址
- **FR-011**: 系統必須驗證使用者輸入的 6 位數驗證碼是否正確
- **FR-012**: 系統必須檢查驗證碼是否在 5 分鐘有效期內
- **FR-013**: 系統必須在驗證碼正確且未過期時，建立使用者帳號並啟用
- **FR-014**: 系統必須在驗證成功後，顯示成功訊息並自動導向登入頁面
- **FR-015**: 系統必須提供「重新發送驗證碼」功能按鈕
- **FR-016**: 系統必須限制「重新發送驗證碼」功能有 60 秒冷卻時間
- **FR-017**: 系統必須在重新發送驗證碼時，將舊驗證碼標記為無效
- **FR-018**: 系統必須在驗證碼輸入頁面顯示倒數計時，提示使用者驗證碼剩餘有效時間
- **FR-019**: 系統必須在驗證碼過期後，禁用驗證碼輸入並提示使用者重新發送

**登入功能**

- **FR-020**: 系統必須提供登入表單，包含 Email 和密碼欄位
- **FR-021**: 系統必須驗證使用者輸入的 Email 和密碼是否與資料庫中的帳號匹配
- **FR-022**: 系統必須在 Email 或密碼錯誤時，顯示統一錯誤訊息「Email 或密碼錯誤」（不透露具體是哪個欄位錯誤）
- **FR-023**: 系統必須在登入成功後，建立使用者會話（session）
- **FR-024**: 系統必須儲存會話資料到本地儲存（持久化），以支援自動登入功能
- **FR-025**: 系統必須在登入成功後，自動導向記帳主頁
- **FR-026**: 系統必須在 APP 啟動時，檢查是否存在有效會話
- **FR-027**: 系統必須在存在有效會話時，跳過登入頁面直接進入記帳主頁
- **FR-028**: 系統必須提供密碼欄位的「顯示/隱藏」切換按鈕

**登出功能**

- **FR-029**: 系統必須在記帳主頁提供「登出」功能按鈕或選單項目
- **FR-030**: 系統必須在使用者點擊登出時，顯示確認對話框「確定要登出嗎？」
- **FR-031**: 系統必須在使用者確認登出後，清除所有本地儲存的會話資料
- **FR-032**: 系統必須在登出後，導向登入頁面

**記帳主頁功能**

- **FR-033**: 系統必須在使用者登入後顯示記帳主頁
- **FR-034**: 記帳主頁必須包含應用程式標題「記帳App」
- **FR-035**: 記帳主頁必須包含選單按鈕（漢堡選單圖示）
- **FR-036**: 記帳主頁必須包含通知按鈕（鈴鐺圖示）
- **FR-037**: 記帳主頁必須顯示「功能開發中」內容區域，包含：
  - 日曆圖示（圓形背景，15% 透明度綠色）
  - 標題「功能開發中」
  - 說明文字「記帳功能即將上線，敬請期待！」
- **FR-038**: 記帳主頁的選單按鈕必須包含「登出」選項

**一般性需求**

- **FR-039**: 系統必須在所有表單欄位提供即時驗證，顯示錯誤訊息於欄位下方
- **FR-040**: 系統必須在處理使用者請求（註冊、登入、發送驗證碼）時，顯示載入指示器並禁用提交按鈕，防止重複提交
- **FR-041**: 系統必須在網路請求失敗時，顯示友善錯誤訊息「網路連線失敗，請檢查網路後重試」
- **FR-042**: 系統必須將所有 Email 地址統一轉換為小寫進行儲存和比對

### Key Entities

- **使用者 (User)**: 代表註冊的應用程式使用者
  - 屬性：使用者 ID（唯一識別碼）、姓名、Email（唯一）、密碼（加密儲存）、帳號狀態（已驗證/未驗證）、註冊時間、最後登入時間
  - 關聯：一個使用者可以有多個會話記錄

- **驗證碼 (VerificationCode)**: 代表發送給使用者進行 Email 驗證的臨時驗證碼
  - 屬性：驗證碼 ID、6 位數字碼、關聯的 Email、建立時間、過期時間（建立時間 + 5 分鐘）、使用狀態（未使用/已使用/已過期）
  - 關聯：每個驗證碼關聯到一個註冊請求（Email）

- **會話 (Session)**: 代表使用者的登入會話
  - 屬性：會話 ID、使用者 ID、建立時間、最後活動時間、裝置資訊（可選）、會話狀態（有效/已登出/已過期）
  - 關聯：每個會話屬於一個使用者

- **註冊請求 (RegistrationRequest)**: 代表使用者的註冊嘗試記錄（用於追蹤和防止濫用）
  - 屬性：請求 ID、姓名、Email、註冊時間、驗證狀態（待驗證/已驗證/已過期）
  - 關聯：每個註冊請求可能關聯多個驗證碼（重新發送的情況）

## Success Criteria

### Measurable Outcomes

- **SC-001**: 使用者可以在 3 分鐘內完成從註冊到 Email 驗證的完整流程（包含接收和輸入驗證碼）
- **SC-002**: 使用者登入流程在 10 秒內完成（從輸入密碼到進入主頁）
- **SC-003**: 90% 的使用者可以在第一次嘗試時成功完成註冊（無需重新發送驗證碼或重新註冊）
- **SC-004**: 驗證碼發送到 Email 的時間在 30 秒內（95% 的情況下）
- **SC-005**: 系統在有效會話存在時，自動登入時間在 2 秒內完成
- **SC-006**: 密碼規則驗證錯誤訊息在使用者輸入時即時顯示（延遲不超過 500 毫秒）
- **SC-007**: 「重新發送驗證碼」功能的 60 秒冷卻計時準確度誤差在 ±1 秒內
- **SC-008**: 使用者在輸入錯誤驗證碼時，立即收到明確的錯誤提示（延遲不超過 1 秒）
- **SC-009**: 登出功能執行時間在 1 秒內完成（從點擊登出到返回登入頁面）
- **SC-010**: 記帳主頁的「功能開發中」內容在頁面載入後 1 秒內完全顯示
- **SC-011**: 系統能夠處理至少 100 個並發註冊請求而不影響回應時間（每個請求在 3 秒內完成）
- **SC-012**: 註冊表單的即時驗證錯誤訊息在使用者離開欄位後立即顯示（延遲不超過 300 毫秒）

### User Satisfaction Metrics

- **SC-013**: 85% 的使用者認為註冊流程簡單易懂（透過使用者回饋問卷測量）
- **SC-014**: 驗證碼輸入介面的使用者滿意度達到 4.0/5.0 以上（透過使用者評分）
- **SC-015**: 使用者在首次使用自動登入功能時，90% 能夠理解該功能的運作方式（無需額外說明）
- **SC-016**: 錯誤訊息的清晰度評分達到 4.0/5.0 以上（使用者能夠根據錯誤訊息自行解決問題）
